<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 9. Criteria Queries</title><link rel="stylesheet" href="css/hibernate.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/><link rel="start" href="index.html" title="Hibernate EntityManager"/><link rel="up" href="index.html" title="Hibernate EntityManager"/><link rel="prev" href="queryhql.html" title="Chapter 8. JP-QL: The Object Query Language"/><link rel="next" href="query_native.html" title="Chapter 10. Native query"/></head><body><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="queryhql.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="query_native.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="querycriteria"/>Chapter 9. Criteria Queries</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="querycriteria.html#querycriteria-typedquery">9.1. Typed criteria queries</a></span></dt><dd><dl><dt><span class="section"><a href="querycriteria.html#querycriteria-typedquery-entity">9.1.1. Selecting an entity</a></span></dt><dt><span class="section"><a href="querycriteria.html#querycriteria-typedquery-expression">9.1.2. Selecting a value</a></span></dt><dt><span class="section"><a href="querycriteria.html#querycriteria-typedquery-multiselect">9.1.3. Selecting multiple values</a></span></dt><dt><span class="section"><a href="querycriteria.html#querycriteria-typedquery-construct">9.1.4. Selecting a wrapper</a></span></dt></dl></dd><dt><span class="section"><a href="querycriteria.html#querycriteria-tuple">9.2. Tuple criteria queries</a></span></dt><dd><dl><dt><span class="section"><a href="querycriteria.html#querycriteria-tuple-access">9.2.1. Accessing tuple elements</a></span></dt></dl></dd><dt><span class="section"><a href="querycriteria.html#querycriteria-from">9.3. FROM clause</a></span></dt><dd><dl><dt><span class="section"><a href="querycriteria.html#querycriteria-from-root">9.3.1. Roots</a></span></dt><dt><span class="section"><a href="querycriteria.html#querycriteria-from-join">9.3.2. Joins</a></span></dt><dt><span class="section"><a href="querycriteria.html#querycriteria-from-fetch">9.3.3. Fetches</a></span></dt></dl></dd><dt><span class="section"><a href="querycriteria.html#querycriteria-path">9.4. Path expressions</a></span></dt><dt><span class="section"><a href="querycriteria.html#querycriteria-param">9.5. Using parameters</a></span></dt></dl></div><p>Criteria queries are a programmatic, type-safe way to express a query.
  They are type-safe in terms of using interfaces and classes to represent
  various structural parts of a query such as the query itself, or the select
  clause, or an order-by, etc. They can also be type-safe in terms of
  referencing attributes as we will see in a bit. Users of the older Hibernate
  <code class="interfacename">org.hibernate.Criteria</code> query API will
  recognize the general approach, though we believe the JPA API to be superior
  as it represents a clean look at the lessons learned from that API.</p><p>Criteria queries are essentially an object graph, where each part of
  the graph represents an increasing (as we navigate down this graph) more
  atomic part of query. The first step in performing a criteria query is
  building this graph. The
  <code class="interfacename">javax.persistence.criteria.CriteriaBuilder</code>
  interface is the first thing with which you need to become acquainted to
  begin using criteria queries. Its role is that of a factory for all the
  individual pieces of the criteria. You obtain a
  <code class="interfacename">javax.persistence.criteria.CriteriaBuilder</code>
  instance by calling the <code class="methodname">getCriteriaBuilder</code> method
  of the
  <code class="interfacename">javax.persistence.EntityManagerFactory</code></p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;builder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;entityManagerFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getCriteriaBuilder</span><!-- <br/> --><span class="java_separator">();</span></pre><p>The next step is to obtain a
  <code class="interfacename">javax.persistence.criteria.CriteriaQuery</code>. You
  do this by one of the 3 methods on
  <code class="interfacename">javax.persistence.criteria.CriteriaBuilder</code>
  for this purpose.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Class</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">)</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Tuple</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;createTupleQuery</span><!-- <br/> --><span class="java_separator">()</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;createQuery</span><!-- <br/> --><span class="java_separator">()</span></pre><p>Each serves a different purpose depending on the expected type of the
  query results.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><em class="citetitle">Chapter 6 Criteria API</em> of
    the [<span class="citation"><a href="bi01.html#JPA2" title="JSR 317: Java™ Persistence API, Version 2.0"><abbr class="abbrev"/></a><a id="JPA2_ABBREV"/><a href="bi01.html#JPA2" title="JSR 317: Java™ Persistence API, Version 2.0"><abbr class="abbrev">JPA 2 Specification</abbr></a></span>] already contains a decent
    amount of reference material pertaining to the various parts of a criteria
    query. So rather than duplicate all that content here, lets instead look
    at some of the more widely anticipated usages of the API.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="querycriteria-typedquery"/>9.1. Typed criteria queries</h2></div></div></div><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Class</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">T</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">)</span></pre><p>The type of the criteria query (aka the &lt;T&gt;) indicates the
    expected types in the query result. This might be an entity, an Integer,
    or any other object.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="querycriteria-typedquery-entity"/>9.1.1. Selecting an entity</h3></div></div></div><p>This the most used form of query in Hibernate Query Language (HQL)
      and Hibernate Criteria Queries. You have an entity and you want to
      select one or more of that entity based on some condition.</p><div class="example"><a id="ex-criteria-typedquery-entity"/><p class="title"><b>Example 9.1. Selecting the root entity</b></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting">CriteriaQuery&lt;<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>Person&gt; criteria = builder.createQuery( Person.class );
Root&lt;Person&gt; personRoot = criteria.from( Person.class );
criteria.selec<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/2.png" alt="(2)"/></span>t( personRoot );
criteria.where<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/3.png" alt="(3)"/></span>( builder.equal( personRoot.get( Person_.eyeColor ), "brown" ) );
List&lt;Person&gt; people = em.createQuery( criteria ).getResultList();
for ( Person p<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>erson : people ) { ... }</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>We use the form <span class="emphasis"><em>createQuery( Person.class
            )</em></span> here because the expected returns are in fact Person
            entities as we see when we begin processing the results.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p><span class="emphasis"><em>personCriteria.select( personRoot )</em></span>
            here is completely unneeded in this specific case because of the
            fact that <span class="emphasis"><em>personRoot</em></span> will be the implied
            selection since we have only a single root. It was done here only
            for completeness of an example</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p><span class="emphasis"><em>Person_.eyeColor</em></span> is an example of the
            static form of metamodel reference. We will use that form
            exclusively in this chapter. See <a href="metamodel.html#metamodel-static" title="4.1. Static metamodel">Section 4.1, “Static metamodel”</a> for details.</p></td></tr></table></div></div></div><br class="example-break"/></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="querycriteria-typedquery-expression"/>9.1.2. Selecting a value</h3></div></div></div><p>The simplest form of selecting a value is selecting a particular
      attribute from an entity. But this might also be an aggregation, a
      mathematical operation, etc.</p><div class="example"><a id="ex-criteria-typedquery-attribute"/><p class="title"><b>Example 9.2. Selecting an attribute</b></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting">CriteriaQuery&lt;<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>Integer&gt; criteria = builder.createQuery( Integer.class );
Root&lt;Person&gt; personRoot = criteria.from( Person.class );
criteria.selec<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/2.png" alt="(2)"/></span>t( personRoot.get( Person_.age ) );
criteria.where( builder.equal( personRoot.get( Person_.eyeColor ), "brown" ) );
List&lt;Integer&gt; <span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>ages = em.createQuery( criteria ).getResultList();
for ( Integer age : ages ) { ... } </pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Notice again the typing of the query based on the
            anticipated result type(s). Here we are specifying
            <code class="classname">java.lang.Integer</code> as the type of the
            <span class="emphasis"><em>Person#age</em></span> attribute is
            <code class="classname">java.lang.Integer</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>We need to bind the fact that we are interested in the age
            associated with the <span class="emphasis"><em>personRoot</em></span>. We might have
            multiple references to the Person entity in the query so we need
            to identify (aka qualify) which <span class="emphasis"><em>Person#age</em></span> we
            mean.</p></td></tr></table></div></div></div><br class="example-break"/><div class="example"><a id="ex-criteria-typedquery-expression"/><p class="title"><b>Example 9.3. Selecting an expression</b></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting">CriteriaQuery&lt;Integer&gt; criteria = builder.createQuery( Integer.class );
Root&lt;Person&gt; personRoot = criteria.from( Person.class );
criteria.selec<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>t( builder.max( personRoot.get( Person_.age ) ) );
criteria.where( builder.equal( personRoot.get( Person_.eyeColor ), "brown" ) );
Integer maxAge = em.createQuery( criteria ).getSingleResult();</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Here we see
            <code class="interfacename">javax.persistence.criteria.CriteriaBuilder</code>
            used to obtain a <span class="emphasis"><em>MAX</em></span> expression. These
            expression building methods return
            <code class="interfacename">javax.persistence.criteria.Expression</code>
            instances typed according to various rules. The rule for a
            <span class="emphasis"><em>MAX</em></span> expression is that the expression type is
            the same as that of the underlying attribute.</p></td></tr></table></div></div></div><br class="example-break"/></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="querycriteria-typedquery-multiselect"/>9.1.3. Selecting multiple values</h3></div></div></div><p>There are actually a few different ways to select multiple values
      using criteria queries. We will explore 2 options here, but an
      alternative recommended approach is to use tuples as described in <a href="querycriteria.html#querycriteria-tuple" title="9.2. Tuple criteria queries">Section 9.2, “Tuple criteria queries”</a></p><div class="example"><a id="ex-criteria-typedquery-array"/><p class="title"><b>Example 9.4. Selecting an array</b></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting">CriteriaQuery&lt;<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>Object[]&gt; criteria = builder.createQuery( Object[].class );
Root&lt;Person&gt; personRoot = criteria.from( Person.class );
Path&lt;Long&gt; idPath = personRoot.get( Person_.id );
Path&lt;Integer&gt; agePath = personRoot.get( Person_.age );
criteria.selec<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/2.png" alt="(2)"/></span>t( builder.array( idPath, agePath ) );
criteria.where( builder.equal( personRoot.get( Person_.eyeColor ), "brown" ) );
List&lt;Object[]&gt;<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span> valueArray = em.createQuery( criteria ).getResultList();
for ( Object[] values : valueArray ) {
    final Long id = (Long) values[0];
    final Integer age = (Integer) values[1];
    ...
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Technically this is classified as a typed query, but as you
            can see in handling the results that is sort of misleading.
            Anyway, the expected result type here is an array.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Here we see the use of the <code class="methodname">array</code>
            method of the
            <code class="interfacename">javax.persistence.criteria.CriteriaBuilder</code>
            which explicitly combines individual selections into a
            <code class="interfacename">javax.persistence.criteria.CompoundSelection</code>.</p></td></tr></table></div></div></div><br class="example-break"/><div class="example"><a id="ex-criteria-typedquery-array2"/><p class="title"><b>Example 9.5. Selecting an array (2)</b></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting">CriteriaQuery&lt;<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>Object[]&gt; criteria = builder.createQuery( Object[].class );
Root&lt;Person&gt; personRoot = criteria.from( Person.class );
Path&lt;Long&gt; idPath = personRoot.get( Person_.id );
Path&lt;Integer&gt; agePath = personRoot.get( Person_.age );
criteria.multi<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/2.png" alt="(2)"/></span>select( idPath, agePath );
criteria.where( builder.equal( personRoot.get( Person_.eyeColor ), "brown" ) );
List&lt;Object[]&gt;<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span> valueArray = em.createQuery( criteria ).getResultList();
for ( Object[] values : valueArray ) {
    final Long id = (Long) values[0];
    final Integer age = (Integer) values[1];
    ...
} </pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Just as we saw in <a href="querycriteria.html#ex-criteria-typedquery-array" title="Example 9.4. Selecting an array">Example 9.4, “Selecting an array”</a> we have a "typed"
            criteria query returning an Object array.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>This actually functions exactly the same as what we saw in
            <a href="querycriteria.html#ex-criteria-typedquery-array" title="Example 9.4. Selecting an array">Example 9.4, “Selecting an array”</a>. The
            <code class="methodname">multiselect</code> method behaves slightly
            differently based on the type given when the criteria query was
            first built, but in this case it says to select and return an
            <span class="emphasis"><em>Object[]</em></span>.</p></td></tr></table></div></div></div><br class="example-break"/></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="querycriteria-typedquery-construct"/>9.1.4. Selecting a wrapper</h3></div></div></div><p>Another alternative to <a href="querycriteria.html#querycriteria-typedquery-multiselect" title="9.1.3. Selecting multiple values">Section 9.1.3, “Selecting multiple values”</a> is to instead select
      an object that will "wrap" the multiple values. Going back to the
      example query there, rather than returning an array of
      <span class="emphasis"><em>[Person#id, Person#age]</em></span> instead declare a class
      that holds these values and instead return that.</p><div class="example"><a id="ex-criteria-typedquery-construct"/><p class="title"><b>Example 9.6. Selecting an wrapper</b></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting">public class P<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>ersonWrapper {
    private final Long id;
    private final Integer age;
    public Per<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>sonWrapper(Long id, Integer age) {
        this.id = id;
        this.age = age;
    }
    ...
}
...
CriteriaQuery&lt;<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/2.png" alt="(2)"/></span>PersonWrapper&gt; criteria = builder.createQuery( PersonWrapper.class );
Root&lt;Person&gt; personRoot = criteria.from( Person.class );
criteria.selec<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/3.png" alt="(3)"/></span>t(
    builder.co<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/3.png" alt="(3)"/></span>nstruct(
        PersonWrapper.class,
        personRoot.get( Person_.id ),
        personRoot.get( Person_.age )
    )
);
criteria.where( builder.equal( personRoot.get( Person_.eyeColor ), "brown" ) );
List&lt;PersonWra<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/2.png" alt="(2)"/></span>pper&gt; people = em.createQuery( criteria ).getResultList();
for ( PersonWrapper person : people ) { ... }</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>First we see the simple definition of the wrapper object we
            will be using to wrap our result values. Specifically notice the
            constructor and its argument types.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Since we will be returning
            <span class="emphasis"><em>PersonWrapper</em></span> objects, we use
            <span class="emphasis"><em>PersonWrapper</em></span> as the type of our criteria
            query.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Here we see another new
            <code class="interfacename">javax.persistence.criteria.CriteriaBuilder</code>
            method, <code class="methodname">construct</code>, which is used to
            builder a wrapper expression. Basically for every row in the
            result we are saying we would like a
            <span class="emphasis"><em>PersonWrapper</em></span> instantiated by the matching
            constructor. This wrapper expression is then passed as the
            select.</p></td></tr></table></div></div></div><br class="example-break"/></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="querycriteria-tuple"/>9.2. Tuple criteria queries</h2></div></div></div><p>A better approach to <a href="querycriteria.html#querycriteria-typedquery-multiselect" title="9.1.3. Selecting multiple values">Section 9.1.3, “Selecting multiple values”</a> is to either use a
    wrapper (which we just saw in <a href="querycriteria.html#querycriteria-typedquery-construct" title="9.1.4. Selecting a wrapper">Section 9.1.4, “Selecting a wrapper”</a>) or using the
    <code class="interfacename">javax.persistence.Tuple</code> contract.</p><div class="example"><a id="ex-criteria-typedquery-tuple"/><p class="title"><b>Example 9.7. Selecting a tuple</b></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting">CriteriaQuery&lt;<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>Tuple&gt; criteria = builder.createTupleQuery();
Root&lt;Person&gt; personRoot = criteria.from( Person.class );
Path&lt;Long&gt; idPath = personRoot.get( Person_.id );
Path&lt;Integer&gt; agePath = personRoot.get( Person_.age );
criteria.multi<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/2.png" alt="(2)"/></span>select( idPath, agePath );
criteria.where( builder.equal( personRoot.get( Person_.eyeColor ), "brown" ) );
List&lt;Tuple&gt; tu<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>ples = em.createQuery( criteria ).getResultList();
for ( Tuple tuple : valueArray ) {
    assert tup<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/3.png" alt="(3)"/></span>le.get( 0 ) == tuple.get( idPath );
    assert tup<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/3.png" alt="(3)"/></span>le.get( 1 ) == tuple.get( agePath );
    ...
} </pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Here we see the use of a new
          <code class="interfacename">javax.persistence.criteria.CriteriaBuilder</code>
          <code class="interfacename">javax.persistence.criteria.CriteriaQuery</code>
          building method, <code class="methodname">createTupleQuery</code>. This is
          exactly equivalent to calling <span class="emphasis"><em>builder.createQuery(
          Tuple.class )</em></span>. It signifies that we want to access the
          results through the
          <code class="interfacename">javax.persistence.Tuple</code>
          contract.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Again we see the use of the
          <code class="methodname">multiselect</code> method, just like in <a href="querycriteria.html#ex-criteria-typedquery-array2" title="Example 9.5. Selecting an array (2)">Example 9.5, “Selecting an array (2)”</a>. The difference here is
          that the type of the
          <code class="interfacename">javax.persistence.criteria.CriteriaQuery</code>
          was defined as
          <code class="interfacename">javax.persistence.Tuple</code> so the
          compound selections in this case are interpreted to be the tuple
          elements.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Here we see
          <code class="interfacename">javax.persistence.Tuple</code> allowing
          different types of access to the results, which we will expand on
          next.</p></td></tr></table></div></div></div><br class="example-break"/><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="querycriteria-tuple-access"/>9.2.1. Accessing tuple elements</h3></div></div></div><p>The <code class="interfacename">javax.persistence.Tuple</code>
      contract provides 3 basic forms of access to the underlying
      elements:</p><div class="variablelist"><dl><dt><span class="term">typed</span></dt><dd><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;X&nbsp;get</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">TupleElement</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;tupleElement</span><!-- <br/> --><span class="java_separator">)</span></pre><p>This allows typed access to the underlying tuple elements.
            We see this in <a href="querycriteria.html#ex-criteria-typedquery-tuple" title="Example 9.7. Selecting a tuple">Example 9.7, “Selecting a tuple”</a> in
            the <span class="emphasis"><em>tuple.get( idPath )</em></span> and
            <span class="emphasis"><em>tuple.get( agePath )</em></span> calls. Just about
            everything is a
            <code class="interfacename">javax.persistence.TupleElement</code>.</p></dd><dt><span class="term">positional</span></dt><dd><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_plain">&nbsp;get</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">int</span><!-- <br/> --><span class="java_plain">&nbsp;i</span><!-- <br/> --><span class="java_separator">)</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;X&nbsp;get</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">int</span><!-- <br/> --><span class="java_plain">&nbsp;i</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Class</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;type</span><!-- <br/> --><span class="java_separator">)</span></pre><p>Very similar to what we saw in <a href="querycriteria.html#ex-criteria-typedquery-array" title="Example 9.4. Selecting an array">Example 9.4, “Selecting an array”</a> and <a href="querycriteria.html#ex-criteria-typedquery-array2" title="Example 9.5. Selecting an array (2)">Example 9.5, “Selecting an array (2)”</a> in terms of positional
            access. Only the second form here provides typing, because the
            user explicitly provides the typing on access. We see this in
            <a href="querycriteria.html#ex-criteria-typedquery-tuple" title="Example 9.7. Selecting a tuple">Example 9.7, “Selecting a tuple”</a> in the
            <span class="emphasis"><em>tuple.get( 0 )</em></span> and <span class="emphasis"><em>tuple.get( 1
            )</em></span> calls.</p></dd><dt><span class="term">aliased</span></dt><dd><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Object</span><!-- <br/> --><span class="java_plain">&nbsp;get</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_plain">&nbsp;alias</span><!-- <br/> --><span class="java_separator">)</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;X&nbsp;get</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">String</span><!-- <br/> --><span class="java_plain">&nbsp;alias</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Class</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;type</span><!-- <br/> --><span class="java_separator">)</span></pre><p>Again, only the second form here provides typing, because
            the user explicitly provides the typing on access. We have not
            seen an example of using this, but its trivial. We would simply,
            for example, have applies an alias to either of the paths like
            <span class="emphasis"><em>idPath.alias( "id" )</em></span> and/or
            <span class="emphasis"><em>agePath.alias( "age" )</em></span> and we could have
            accessed the individual tuple elements by those specified
            aliases.</p></dd></dl></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="querycriteria-from"/>9.3. FROM clause</h2></div></div></div><div class="blockquote"><table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td width="10%" valign="top"> </td><td width="80%" valign="top"><p>A CriteriaQuery object defines a query over one or more entity,
      embeddable, or basic abstract schema types. The root objects of the
      query are entities, from which the other types are reached by
      navigation.</p></td><td width="10%" valign="top"> </td></tr><tr><td width="10%" valign="top"> </td><td colspan="2" align="right" valign="top">--<span class="attribution">[<span class="citation"><a href="bi01.html#JPA2" title="JSR 317: Java™ Persistence API, Version 2.0"><abbr class="abbrev"/></a><a id="JPA2_ABBREV"/><a href="bi01.html#JPA2" title="JSR 317: Java™ Persistence API, Version 2.0"><abbr class="abbrev">JPA 2 Specification</abbr></a>, section 6.5.2 Query
      Roots, pg 262</span>]</span></td></tr></table></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>All the individual parts of the FROM clause (roots, joins, paths)
      implement the
      <code class="interfacename">javax.persistence.criteria.From</code>
      interface.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="querycriteria-from-root"/>9.3.1. Roots</h3></div></div></div><p>Roots define the basis from which all joins, paths and attributes
      are available in the query. In a criteria query, a root is always an
      entity. Roots are defined and added to the criteria by the overloaded
      <code class="methodname">from</code> methods on
      <code class="interfacename">javax.persistence.criteria.CriteriaQuery</code>:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Root</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;from</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Class</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">)</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Root</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;from</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">EntityType</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">X</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_separator">)</span></pre><div class="example"><a id="d0e4612"/><p class="title"><b>Example 9.8. Adding a root</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;personCriteria&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;builder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;create&nbsp;and&nbsp;add&nbsp;the&nbsp;root</span>
<!--  --><br/><span class="java_plain">person</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/><p>Criteria queries may define multiple roots, the effect of which is
      to create a <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://en.wikipedia.org/wiki/Cartesian_product">cartesian
      product</a> between the newly added root and the others. Here is an
      example matching all single men and all single women:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;builder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Root</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;men&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Root</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;women&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Predicate</span><span class="java_plain">&nbsp;menRestriction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">and</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">equal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;men</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person_</span><span class="java_separator">.</span><span class="java_plain">gender&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">Gender</span><span class="java_separator">.</span><span class="java_plain">MALE&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">equal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;men</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person_</span><span class="java_separator">.</span><span class="java_plain">relationshipStatus&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">RelationshipStatus</span><span class="java_separator">.</span><span class="java_plain">SINGLE&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Predicate</span><span class="java_plain">&nbsp;womenRestriction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">and</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">equal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;women</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person_</span><span class="java_separator">.</span><span class="java_plain">gender&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">Gender</span><span class="java_separator">.</span><span class="java_plain">FEMALE&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">equal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;women</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person_</span><span class="java_separator">.</span><span class="java_plain">relationshipStatus&nbsp;</span><span class="java_separator">),</span><span class="java_plain">&nbsp;</span><span class="java_type">RelationshipStatus</span><span class="java_separator">.</span><span class="java_plain">SINGLE&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">where</span><span class="java_separator">(</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">and</span><span class="java_separator">(</span><span class="java_plain">&nbsp;menRestriction</span><span class="java_separator">,</span><span class="java_plain">&nbsp;womenRestriction&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span></pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="querycriteria-from-join"/>9.3.2. Joins</h3></div></div></div><p>Joins allow navigation from other
      <code class="interfacename">javax.persistence.criteria.From</code> to either
      association or embedded attributes. Joins are created by the numerous
      overloaded <code class="methodname">join</code> methods of the
      <code class="interfacename">javax.persistence.criteria.From</code>
      interface:</p><div class="example"><a id="criteria-join-singular"/><p class="title"><b>Example 9.9. Example with Embedded and ManyToOne</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;personCriteria&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;builder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Root</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;personRoot&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;person</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_plain">address&nbsp;is&nbsp;an&nbsp;embedded&nbsp;attribute</span>
<!--  --><br/><span class="java_type">Join</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_separator">,</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;personAddress&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;personRoot</span><span class="java_separator">.</span><span class="java_plain">join</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person_</span><span class="java_separator">.</span><span class="java_plain">address&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_plain">country&nbsp;is&nbsp;a&nbsp;</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_type">Join</span><span class="java_operator">&lt;</span><span class="java_type">Address</span><span class="java_separator">,</span><span class="java_type">Country</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addressCountry&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;personAddress</span><span class="java_separator">.</span><span class="java_plain">join</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Address_</span><span class="java_separator">.</span><span class="java_plain">country&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/><div class="example"><a id="criteria-join-plural"/><p class="title"><b>Example 9.10. Example with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;personCriteria&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;builder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Root</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;personRoot&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;person</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Join</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_separator">,</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;personRoot</span><span class="java_separator">.</span><span class="java_plain">join</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person_</span><span class="java_separator">.</span><span class="java_plain">orders&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Join</span><span class="java_operator">&lt;</span><span class="java_type">Order</span><span class="java_separator">,</span><span class="java_type">LineItem</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orderLines&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">.</span><span class="java_plain">join</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Order_</span><span class="java_separator">.</span><span class="java_plain">lineItems&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="querycriteria-from-fetch"/>9.3.3. Fetches</h3></div></div></div><p>Just like in HQL and EJB-QL, we can specify that associated data
      be fetched along with the owner. Fetches are created by the numerous
      overloaded <code class="methodname">fetch</code> methods of the
      <code class="interfacename">javax.persistence.criteria.From</code>
      interface:</p><div class="example"><a id="criteria-fetch-singular"/><p class="title"><b>Example 9.11. Example with Embedded and ManyToOne</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;personCriteria&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;builder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Root</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;personRoot&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;person</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_plain">address&nbsp;is&nbsp;an&nbsp;embedded&nbsp;attribute</span>
<!--  --><br/><span class="java_type">Join</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_separator">,</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;personAddress&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;personRoot</span><span class="java_separator">.</span><span class="java_plain">fetch</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person_</span><span class="java_separator">.</span><span class="java_plain">address&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_plain">country&nbsp;is&nbsp;a&nbsp;</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_type">Join</span><span class="java_operator">&lt;</span><span class="java_type">Address</span><span class="java_separator">,</span><span class="java_type">Country</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;addressCountry&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;personAddress</span><span class="java_separator">.</span><span class="java_plain">fetch</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Address_</span><span class="java_separator">.</span><span class="java_plain">country&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Technically speaking, embedded attributes are always fetched
        with their owner. However in order to define the fetching of
        <span class="emphasis"><em>Address#country</em></span> we needed a
        <code class="interfacename">javax.persistence.criteria.Fetch</code> for
        its parent path.</p></div><div class="example"><a id="criteria-fetch-plural"/><p class="title"><b>Example 9.12. Example with Collections</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">CriteriaQuery</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;personCriteria&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;builder</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Person</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Root</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;personRoot&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;person</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Join</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_separator">,</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;personRoot</span><span class="java_separator">.</span><span class="java_plain">fetch</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person_</span><span class="java_separator">.</span><span class="java_plain">orders&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Join</span><span class="java_operator">&lt;</span><span class="java_type">Order</span><span class="java_separator">,</span><span class="java_type">LineItem</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orderLines&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">.</span><span class="java_plain">fetch</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Order_</span><span class="java_separator">.</span><span class="java_plain">lineItems&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="querycriteria-path"/>9.4. Path expressions</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Roots, joins and fetches are themselves paths as well.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="querycriteria-param"/>9.5. Using parameters</h2></div></div></div><div class="example"><a id="ex-querycriteria-param"/><p class="title"><b>Example 9.13. Using parameters</b></p><div class="example-contents"><div class="programlistingco"><pre class="programlisting">CriteriaQuery&lt;Person&gt; criteria = build.createQuery( Person.class );
Root&lt;Person&gt; personRoot = criteria.from( Person.class );
criteria.select( personRoot );
ParameterExpre<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/1.png" alt="(1)"/></span>ssion&lt;String&gt; eyeColorParam = builder.parameter( String.class );
criteria.where<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/2.png" alt="(2)"/></span>( builder.equal( personRoot.get( Person_.eyeColor ), eyeColorParam ) );
TypedQuery&lt;Person&gt; query = em.createQuery( criteria );
query.setParam<span xmlns="" class="co"><img src="images/org/hibernate/docbook/callouts/3.png" alt="(3)"/></span>eter( eyeColorParam, "brown" );
List&lt;Person&gt; people = query.getResultList();</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/1.png" alt="1" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Use the <code class="methodname">parameter</code> method of
            <code class="interfacename">javax.persistence.criteria.CriteriaBuilder</code>
            to obtain a parameter reference.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/2.png" alt="2" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Use the parameter reference in the criteria query.</p></td></tr><tr><td width="5%" valign="top" align="left"><img xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" src="images/org/hibernate/docbook/callouts/3.png" alt="3" border="0" height="17px" width="17px"/></td><td valign="top" align="left"><p>Use the parameter reference to bind the parameter value to
            the
            <code class="interfacename">javax.persistence.TypedQuery</code></p></td></tr></table></div></div></div></div><br class="example-break"/></div></div><HR xmlns=""/><a xmlns="" href=""><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2005 Red Hat Inc. and the various authors</p></a><ul class="docnav"><li class="previous"><a accesskey="p" href="queryhql.html"><strong>Prev</strong>Chapter 8. JP-QL: The Object Query Language</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="query_native.html"><strong>Next</strong>Chapter 10. Native query</a></li></ul></body></html>